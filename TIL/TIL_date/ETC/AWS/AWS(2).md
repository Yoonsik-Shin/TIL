# AWS (2) - EC2

​    

> IAM 유저 결제 정보 열람 허용

- 루트 계정에서 설정

![image-20230604165719358](AWS(2).assets/image-20230604165719358.png)

​    

프리티어 확인법

![image-20230604170010802](AWS(2).assets/image-20230604170010802.png)

![image-20230604170016734](AWS(2).assets/image-20230604170016734.png)



비용초과 방지법

![image-20230604170159232](AWS(2).assets/image-20230604170159232.png)

​    

- Elastic Compute Cloud
- Infrastructure as a Service
- EC2 인스턴스 : 가상 머신 임대
- EBS 볼륨 : 가상 드라이브
- ELB (Elastic Load Balancer) : 부하분산
- ASG (Auto Scaling Group) : 서비스 확장



- 운영체제
  - Linux, window, mac
- 가상 머신에 사용할 컴퓨팅 성능과 코어 (CPU) 선택가능
- RAM 용량 선택가능
- EBS, EFS 용량 선택가능 (네트워크 기반)
- EC2 Instance Store (하드웨어 기반)
- EC2 인스턴스에 연결할 네트워크 유형 선택가능
  - 네트워크 카드의 속도, 사용할 공개 IP 설정가능
- 보안그룹 :  EC2 인스턴스의 방화벽 규칙 정의
- EC2 User Date : 부트스트랩 스크립트를 이용해 처음 시작할 때의 인스턴스 구성가능

 

EC2 사용자 데이터 (User Data)

- EC2가 시작될 때 부트스트래핑됨

- 부트스트래핑되는 것들

  - 업데이트 설치

  - 소프트웨어 설치

  - 인터넷에서 일반 파일 다운로드

  - 그 외 원하는 작업

- 스크립트는 루트 사용자로 실행됨

부트스트래핑

- 머신이 시작할 때 명령을 실행하는 것
- 스크립트는 처음 시작할 때 한 번 실행되고 다시는 실행되지 않음



EC2 인스턴스 타입

| Instance    | vCPU | Mem (GiB) | Storage          | Network Performance | EBS Bandwidth (Mbps) |
| ----------- | ---- | --------- | ---------------- | ------------------- | -------------------- |
| t2.micro    | 1    | 1         | EBS Only         | Low to Moderate     |                      |
| t2.xlarge   | 4    | 16        | EBS Only         | Moderate            |                      |
| c5d.4xlarge | 16   | 32        | 1 x 400 NVMe SSD | Up to 10 Gbps       | 4750                 |
| r5.16xlarge | 64   | 512       | EBS Only         | 20 Gbps             | 13600                |
| m5.8xlarge  | 32   | 128       | EBS Only         | 10 Gbps             | 6800                 |

> t2.micro는 프리티어가 지원됨

​    

EC2 인스턴스 시작하기

![image-20230604172106844](AWS(2).assets/image-20230604172106844.png)

![image-20230604172149129](AWS(2).assets/image-20230604172149129.png)

![image-20230604172216248](AWS(2).assets/image-20230604172216248.png)

![image-20230604172302842](AWS(2).assets/image-20230604172302842.png)

![image-20230604172323465](AWS(2).assets/image-20230604172323465.png)

![image-20230604172446741](AWS(2).assets/image-20230604172446741.png)

![image-20230604172534769](AWS(2).assets/image-20230604172534769.png)

![image-20230604172626301](AWS(2).assets/image-20230604172626301.png)

![image-20230604172901130](AWS(2).assets/image-20230604172901130.png)

- 프라이빗 IP는 항상 동일하게 유지됨
- 공개 IP는 바뀔 수 있음

​    

EC2 인스턴스 유형

https://aws.amazon.com/ko/ec2/instance-types/

네이밍 컨벤션

m5.2xlarge

- m : 인스턴스 클래스
- 5 : 인스턴스 세대
- 2xlarge : 인스턴스 클래스 내에서의 크기



1. 범용

   - 웹 서버, 코드저장소등의 작업에 적합
   - 컴퓨팅, 메모리, 네트워킹 간의 균형이 잘 맞음
   - 보통 프리티어 범용 인스턴스인 t2.micro를 많이 사용함

   ![image-20230604214536546](AWS(2).assets/image-20230604214536546.png)

2. 컴퓨팅 최적화

   - 일부 데이터의 일괄 처리
   - CPU와 컴퓨팅 파워에 특화 되어있음
   - C로 시작하는 이름을 가짐
   - 미디어 트랜스코딩 작업
   - 고성능 웹서버
   - HPC 작업
   - 머신러닝
   - 전용 게임 서버

   ![image-20230604214458212](AWS(2).assets/image-20230604214458212.png)

3. 메모리 최적화

   - 메모리에서 대규모 데이터셋을 처리하는 유형의 작업에서 빠른 성능 제공
   - 고성능의 관계형/비관계 DB에 사용
   - 분산 웹스케일 캐시 저장소 (일라스틱 캐시)
   - 비즈니스 인텔리전스에 최적화된 인 메모리 DB
   - 대규모 비정형 데이터의 실시간 처리를 실행하는 애플리케이션

   ![image-20230604214550108](AWS(2).assets/image-20230604214550108.png)

4. 스토리지 최적화
   - 로컬 스토리지에서 대규모의 데이터셋에 엑세스할 때 적합한 인스턴스
   - 고주파 온라인 트랜잭션 처리인 OLTP에 사용
   - 관계형 DB, NoSQL
   - 인 메모리 DB의 캐시 (Redis)
   - 데이터 웨어하우징 애플리케이션
   - 분산 파일 시스템

![image-20230604214854592](AWS(2).assets/image-20230604214854592.png)

​    

### EC2 인스턴스 방화벽

- 보안 그룹
  - AWS 클라우드에서 네트워크 보안을 실현하는 기본적인 기능
  - 인바운드 / 아웃바운드 트래픽을 제어함
  - 오직 허용 규칙만 사용함
  - IP 주소를 참조하거나, 다른 보안 그룹을 참조함 (보안 그룹끼리 서로 참조 가능)
  - 방화벽 역할을 함
  - 포트에 대한 엑세스를 관리
  - 인증된 IP 범위 확인 (IPv4, IPv6)
  - 외부에서 인스턴스로 연결하는 인바운드 네트워크 제어 (기본적으로 모든 인바운드 트래픽은 차단됨)
  - 인스턴스에서 외부로 연결하는 네트워크 제어 (기본적으로 모든 아웃바운드 트래픽 허용)
  - 여러 인스턴스와 하나의 보안그룹, 하나의 보안그룹에 여러 인스턴스를 가질 수 있음
  - 리전이나 특정 VPC 조합에 고정됨
  - EC2 외부에 존재하여 트래픽이 차단되면 EC2 인스턴스는 이를 확인할 수 없음
  - SSH 전용으로 별도 보안 그룹을 관리하는 것이 바람직함
  - 애플리케이션이 액세스할 수 없어서 타임아웃(timeout)이 발생한다면 이는 보안 그룹 문제
  - 연결 거부(connection refused) 오류 발생는 보안 그룹은 동작하고 트래픽은 통과했지만 애플리케이션 오류나 다른 요인이 문제일 수 있음

- 포트
  - 22 (SSH) Secure Shell : 리눅스 EC2 인스턴스에 로그인할 때 사용
  - 21 (FTP) File Transfer Protocol : 파일 전송 프로토콜로 파일 공유, 파일 업로드시 사용
  - 22 (SFTP) Secure File Transfer Protocol : 보안 파일 전송 프로토콜로 SSH를 활용하여 파일을 공유함
  - 80  (HTTP) : 보안이 적용되지 않은 웹사이트에 액세스할 때 사용
  - 443 (HTTPS) : 보안이 적용된 웹사이트
  - 3389 (RDP) Remot Desktop Protocol : 원격 데스크탑 프로토콜용, 윈도우 인스턴스 로그인에 사용됨



![image-20230605102926441](AWS(2).assets/image-20230605102926441.png)

​    

SSH

- mac, linux, window10 이상 사용가능
- window는 버전에 상관없이 putty를 이용가능

EC2 Instance Connect 웹페이지에서 사용되어, 모든 OS 사용가능



EC2 인스턴스에 IAM 역할 연결하기

![image-20230605104913527](AWS(2).assets/image-20230605104913527.png)

![image-20230605104950616](AWS(2).assets/image-20230605104950616.png)

![image-20230605105002044](AWS(2).assets/image-20230605105002044.png)

![image-20230605105018944](AWS(2).assets/image-20230605105018944.png)



### EC2 인스턴스 구매옵션

- 온디맨드 인스턴스 (On demand)
  - 요청에 따라 언제든지 실행할 수 있음
  - 사용한 만큼 지불
  - linux, window : 1분이 지난후 초당 비용을 지불
  - 다른 OS : 시간당 비용 청구
  - 가격이 제일 높지만, 선결제가 없고 장기 약정도 필요하지 않음
  - 애플리케이션의 동작을 예측할 수 없는 연속적인 단기 워크로드에 적합함
- 예약 인스턴스 (Reserved)
  - 1년 or 3년 사용
  - 온디맨드에 비하면 대략 72% 저렴 (퍼센트는 언제든지 바뀔 수 있음)
  - 특정 인스턴스 속성들을 예약할 수 있음 (인스턴스 유형, 리전, 테넌시, OS)
  - 3년 이용시 1년보다 저렴
  - 전체 선결제, 부분 선결제가 가능하고 선결제 없이도 가능함
  - 전체 선결제가 가장 할인율 높음
  - 애플리케이션이 안정된 상태로 사용되는 DB등에 사용하기에 적합
  - 마켓 플레이스에서 예약 인스턴스를 구매하거나 판매할 수 있음
- 전환형 예약 인스턴스 
  - 유연성 있는 인스턴스가 필요한 경우 (시간에 따라 인스턴스 유형을 변경)
  - 유연성이 높아 할인율이 줄어듬 (약 66%)
- Savings Plans (Savings Plans)
  - 시간당 10달러의 비용을 1년 or 3년 기간으로 약정
  - 초과하는 사용량은 온디맨드 가격으로 청구됨
  - 특정 인스턴스 제품군과 리전에 한해 사용할 수 있음 (M5 in Seoul)
  - 인스턴스 크기에 구애받지 않음
  - OS는 linux와 window 간에 전환 가능
  - 태넌시는 호스트, 전용, 기본으로 전환 가능
- 스팟 인스턴스 (Spot instances)
  - 아주 짧은 단기 워크로드용
  - 대략 90% 까지 저렴함
  - 언제든지 인스턴스가 중단될 수 있어 안정성이 떨어짐
  - 서비스가 중단되어도 복구하기 쉬운 워크로드에 사용함
    - 배치 작업
    - 데이터 분석
    - 이미지 처리
    - 분산된 워크로드
    - 시작/종료 시점이 유동적인 워크로드
  - 중요한 작업이나 DB에는 적합하지 않음
- 전용 호스트 (Dedicated Hosts)
  - 물리적 서버 전체를 예약하고 인스턴스 배치를 제어할 수 있음
  - 규정 준수 요구 사항이 있거나, 기존 서버 결합 SW라이선스를 사용해야 할 경우 사용
  - 비용은 소켓당, 코어당, VM SW라이선스당 청구됨
  - 구매 옵션
    - 온디맨드 : 초당 청구
    - 1년 or 3년 예약
  - AWS에서 가장 비쌈
- 전용 인스턴스
  - 사용자 하드웨어에 고유한 인스턴스를 갖음
  - 다른 사람에게 하드웨어를 공유하지 않음
- 용량 예약 (Capacity Reservations)
  - 특정한 AZ의 용량을 원하는 기간동안 예약할 수 있음
  - 시간약정이 없어 언제든지 시작/종료가 가능해, 가격 할인이 없음
  - 인스턴스 실행 여부와 관계없이 온드맨드로 요금이 청구됨

​    

## EBS

- EC2 인스턴스 스토리지

EBS 볼륨 (Elastic Block Store)

- 인스턴스가 실행중인 동안 연결 가능한 네트워크 드라이브 
- 네트워크 USB 스틱
- 인스턴스가 종료된 후에도 데이터를 지속할 수 있음
- EBS 볼륨 생성시 특정 가용 영역에서만 가능
- 스냅샷을 이용하면 다른 가용 영역으로도 봄륨을 옮길 수 있음
- 미리 사용할 용량을 결정해야함 (GB, IOPS(단위 초당 전송수))
- 미리 결정된 용량에 따라 요금이 청구됨
- 더 좋은 성능이나 사이즈가 필요하면 이후에 용량 늘릴 수 있음
- 매달 30GB의 범용 SSD or 마그네틱 유형의 EBS 스토리지를 프리티어로 제공함 (gp2, gp3)
- 인스턴스와 EBS 볼륨이 서로 통신하기 위해서는 네트워크가 필요 (지연이 생길 수 있음)
- EC2 인스턴스에서 분리될 수 있고, 매우 빠르게 다른 인스턴스에 연결 할 수 있음
- 인스턴스 하나에 여러개의 EBS 볼륨을 장착할 수 있음EC2 인스턴스를 통해 EBS 볼륨을 생성하는 경우, 종료시 삭제 옵션 설정 가능
- 기본적으로 루트 EBS 볼륨은 인스턴스 종료와 함께 삭제되도록 설정되어 있음
- EC2 인스턴스를 종료시에도 루트 볼륨을 유지하고 싶은 경우 종료시 삭제 옵션 비활성화

![image-20230605163650171](AWS(2).assets/image-20230605163650171.png)

![image-20230605163738107](AWS(2).assets/image-20230605163738107.png)

![image-20230605163835809](AWS(2).assets/image-20230605163835809.png)

![image-20230605163928607](AWS(2).assets/image-20230605163928607.png)

![image-20230605163942422](AWS(2).assets/image-20230605163942422.png)

![image-20230605164020620](AWS(2).assets/image-20230605164020620.png)



새로운 블록 디바이스를 실제 사용하는법은 '`포맷 EBS 볼륨 EC2 부착 검색`을 검색

![image-20230605164334717](AWS(2).assets/image-20230605164334717.png)

![image-20230605164355832](AWS(2).assets/image-20230605164355832.png)

​    

### EBS 스냅샷

- EBS 볼륨의 특정 시점에서의 백업
- 다른 가용 영역 or 다른 리전에 복사 가능

기능

1. EBS 스냅샷 아카이브
   - 스냅샷을 최대 75% 더 저렴한 아카이브 티어로 옮길 수 있는 기능
   - 스냅샷을 아카이브 티어로 옮기면 아카이브를 복원하는데 24~72시간 걸림
2. EBS 스냅샷을 위한 휴지통
   - 영구적으로 삭제하는 대신 휴지통에 보관됨
   - 보관기간은 하루에서 1년까지 설정가능
3. 빠른 스냅샷 복원 (FSR : Fast Snapshot Restore)
   - 스냅샷을 처음 사용할 때 대기 시간이 없도록 스냅샷을 완전히 초기화
   - 스냅샷이 매우 클 때 EBS 볼륨을 초기화해야하거나 매우 빠르게 인스턴스화 해야하는 경우 유용
   - 비용이 매우 비쌈

![image-20230605165057826](AWS(2).assets/image-20230605165057826.png)

![image-20230605165115535](AWS(2).assets/image-20230605165115535.png)

![image-20230605165301054](AWS(2).assets/image-20230605165301054.png)

![image-20230605165317852](AWS(2).assets/image-20230605165317852.png)

- 볼륨 자체를 재생성하기

![image-20230605165401850](AWS(2).assets/image-20230605165401850.png)

![image-20230605165424151](AWS(2).assets/image-20230605165424151.png)

- 휴지통

![image-20230605165457708](AWS(2).assets/image-20230605165457708.png)

![image-20230605165515315](AWS(2).assets/image-20230605165515315.png)

![image-20230605165538760](AWS(2).assets/image-20230605165538760.png)

![image-20230605165552733](AWS(2).assets/image-20230605165552733.png)

- 스냅샷 아카이브

![image-20230605165706916](AWS(2).assets/image-20230605165706916.png)

![image-20230605165717538](AWS(2).assets/image-20230605165717538.png)